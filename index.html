async fetchQuestions() {
                // Step 1: Fetch all questions from the database
                let query = db.collection('questions');
                
                // Apply marked filter at the database level if checked
                if (this.markedOnly) {
                    query = query.where('stats.marked', '==', true);
                }
                
                const snapshot = await query.get();
                let allQuestions = [];
                
                // Step 2: Apply client-side filters for mastery and exclusion
                snapshot.forEach(doc => {
                    const data = doc.data();
                    const stats = data.stats || {};
                    stats.attempts = stats.attempts || 0;
                    stats.correct = stats.correct || 0;
                    stats.marked = stats.marked || false;
                    
                    // Filter 1: Exclude marked questions if the option is checked
                    if (this.excludeMarked && stats.marked) {
                        return; // Skip this question
                    }

                    // Filter 2: Check mastery percentage (This is the core fix)
                    const masteryPercent = this.calculateMastery(stats);
                    if (masteryPercent <= this.maxMasteryLimit) {
                        // If the question is within the mastery limit, add it
                        allQuestions.push({
                            id: doc.id,
                            ...data,
                            stats: stats,
                            masteryPercent: masteryPercent
                        });
                    }
                });

                if (allQuestions.length === 0) {
                    return;
                }
                
                // ... (The rest of the function remains the same)
                // Shuffle the questions that passed the filters
                this.shuffleArray(allQuestions);
                
                if (this.freeRunnerMode) {
                    this.quizData = allQuestions;
                    this.allQuestions = [];
                } else {
                    this.quizData = allQuestions.slice(0, this.questionCount);
                    this.allQuestions = allQuestions.slice(this.questionCount);
      _BOS_
